<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Portrait â€” Fixed</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      body{margin:0;overflow:hidden;font-family:Arial,Helvetica,sans-serif}
      .hud{position:fixed;z-index:999;left:10px;top:10px;padding:8px;background:rgba(0,0,0,0.6);color:#fff;border-radius:6px;font-size:14px}
      .note{font-size:12px;opacity:0.9}
      a{color:#ffd}
    </style>
  </head>
  <body>
    <div class="hud" id="hud">
      #6THIS IS NEWESTPointink ta savo the camera at a Hiro marker. Tap this HUD to allow video autoplay.
    </div>

    <a-scene embedded arjs="sourceType: webcam;">
      <a-assets>
        <video id="portraitVideo" src="video.mp4" loop crossorigin="anonymous" playsinline webkit-playsinline></video>

        <img id="fallbackImg" src="data:image/svg+xml;utf8,
        %3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512'%3E
          %3Crect width='100%25' height='100%25' fill='%23e8e8e8'/%3E
          %3Ctext x='50%25' y='46%25' font-size='28' text-anchor='middle' fill='%23666'%3E
            PLACEHOLDER%3C/text%3E
          %3Ctext x='50%25' y='60%25' font-size='18' text-anchor='middle' fill='%23666'%3E
            add%20video.mp4%20to%20see%20a%20video%20overlay%3C/text%3E
        %3C/svg%3E" />
      </a-assets>

      <!-- Hiro marker -->
  <a-marker type="pattern" url="pattern-marker.patt" id="customMarker">
      <a-video id="hiroVideo" src="#portraitVideo"
               width="1.2" height="0.9"
               position="0 0.6 0.1"
               rotation="-90 180 180"
               scale="1 1 1"
               visible="false"
               material="side: double;"></a-video>
    
      <!-- fallback plane -->
      <a-plane id="hiroFallback" src="#fallbackImg"
               width="1" height="1"
               position="0 0.6 0"
               rotation="-90 0 0"></a-plane>
</a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const video = document.getElementById('portraitVideo');

      function showVideoOn(markerEl) {
        const v = markerEl.querySelector('a-video');
        const fb = markerEl.querySelector('a-plane');
        if(v) v.setAttribute('visible', 'true');
        if(fb) fb.setAttribute('visible', 'false');
        video.play().catch(()=>{});
      }

      function showFallbackOn(markerEl) {
        const v = markerEl.querySelector('a-video');
        const fb = markerEl.querySelector('a-plane');
        if(v) v.setAttribute('visible', 'false');
        if(fb) fb.setAttribute('visible', 'true');
      }

      document.querySelectorAll('a-marker').forEach(marker=>{
        marker.addEventListener('markerFound', ()=>{
          if(video.readyState >= 3){
            showVideoOn(marker);
          } else {
            showFallbackOn(marker);
          }
        });
        marker.addEventListener('markerLost', ()=>{
          if(video && !video.paused) video.pause();
        });
      });

      document.getElementById('hud').addEventListener('click', ()=>{
        video.play().catch(()=>{});
      });
    </script>
  </body>
</html>
