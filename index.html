<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Portrait â€” Image Overlay</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      body{margin:0;overflow:hidden;font-family:Arial,Helvetica,sans-serif}
      .hud{position:fixed;z-index:999;left:10px;top:10px;padding:8px;background:rgba(0,0,0,0.6);color:#fff;border-radius:6px;font-size:14px}
      .note{font-size:12px;opacity:0.9}
      a{color:#ffd}
    </style>
  </head>
  <body>
    <div class="hud" id="hud">
      Point your camera at the marker defined by pattern-Pirma (2).patt.
    </div>

    <a-scene embedded arjs="sourceType: webcam;">
      <a-assets>
        <img id="portraitImage" src="Pirma.jpg" crossorigin="anonymous">

        <img id="fallbackImg" src="data:image/svg+xml;utf8,
        %3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512'%3E
          %3Crect width='100%25' height='100%25' fill='%23e8e8e8'/%3E
          %3Ctext x='50%25' y='46%25' font-size='28' text-anchor='middle' fill='%23666'%3E
            LOADING IMAGE%3C/text%3E
          %3Ctext x='50%25' y='60%25' font-size='18' text-anchor='middle' fill='%23666'%3E
            Ensure Pirma.jpg is in the same folder%3C/text%3E
        %3C/svg%3E" />
      </a-assets>

      <a-marker type="pattern" url="pattern-Pirma (2).patt" id="customMarker">
        
        <a-image id="hiroImage" src="#portraitImage"
                 width="1.2" height="0.9"
                 position="0 0.6 0.1"
                 rotation="-90 0 0"
                 scale="1 1 1"
                 visible="false"
                 material="side: double;"></a-image>
        
        <a-plane id="hiroFallback" src="#fallbackImg"
                 width="1" height="1"
                 position="0 0.6 0"
                 rotation="-90 0 0"></a-plane>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // The image element (used to check if it's loaded)
      const image = document.getElementById('portraitImage');
      const markerEl = document.getElementById('customMarker');

      // Functions adapted to show/hide the image plane
      function showImageOn(markerEl) {
        // Now targeting the a-image element
        const v = markerEl.querySelector('a-image'); 
        const fb = markerEl.querySelector('a-plane');
        if(v) v.setAttribute('visible', 'true');
        if(fb) fb.setAttribute('visible', 'false');
        // No video.play() needed for images
      }

      function showFallbackOn(markerEl) {
        // Still targeting the a-image for hiding
        const v = markerEl.querySelector('a-image'); 
        const fb = markerEl.querySelector('a-plane');
        if(v) v.setAttribute('visible', 'false');
        if(fb) fb.setAttribute('visible', 'true');
      }

      // Event listeners adapted for image loading logic
      // We check the image 'complete' property instead of video's readyState
      markerEl.addEventListener('markerFound', ()=>{
        if(image.complete && image.naturalHeight !== 0){
          showImageOn(markerEl);
        } else {
          showFallbackOn(markerEl);
        }
      });
      
      markerEl.addEventListener('markerLost', ()=>{
        // No pause logic needed for a static image
        // Optionally hide the image
        // showFallbackOn(markerEl); 
      });

      // Simple image loaded listener to ensure we can switch planes if marker is already found
      image.onload = () => {
          // If the image loads while the marker is visible, show the image
          if (markerEl.object3D.visible) {
              showImageOn(markerEl);
          }
      };

      // The HUD click handler is no longer needed for autoplay, but we keep it simple
      document.getElementById('hud').addEventListener('click', ()=>{
        console.log('HUD clicked. Image overlay is static, no video action needed.');
      });
    </script>
  </body>
</html>
